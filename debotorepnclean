#!/bin/bash
bold=$(tput bold)
normal=$(tput sgr0)
echo "${bold}*********************************************************************"
echo "${bold}**     Bienvenu(e) dans la petite maintenance Debian de Zheyo      **"
echo "${bold}*********************************************************************"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}| Mise-à-jour de la liste du répertoire des paquets${normal}"
apt update
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}| Nettoyage des paquets non utilisés${normal}"
apt autoclean -y && apt autoremove -y
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}| Mise-à-jour complète des paquets${normal}"
apt full-upgrade -y
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}| Correction des fichiers manquants, des paquets cassés et des dépendances${normal}"
apt update --fix-missing && apt --fix-broken install  && apt -f -y install
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}| Nettoyage du répertoire de paquets${normal}"
apt autoclean -y
rm -r -f ~/.local/share/Trash/*/*
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}| Nettoyages des résidus des logiciels désinstallés${normal}"
[[ $(dpkg -l | grep ^rc) ]] && dpkg -P $(dpkg -l | awk '/^rc/{print $2}') || echo "Aucun résidu trouvé."
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}| Nettoyages des vieux noyaux${normal}"
apt autoremove --purge -y
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}| Nettoyage des snaps désactivés${normal}"
snap list --all | awk '/désactivé|disabled/{print $1, $3}' | while read snapname revision; do snap remove "$snapname" --revision="$revision"; done
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}| Nettoyage des indépendances${normal}"
apt purge $(dpkg -l | awk '/^rc/{print $2}') -y
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}|"
echo "${bold}| Petite Maintenance de Zheyo Terminée!${normal}"
